# 小车位置显示 - 快速参考

## 🚀 快速诊断

### 1. 检查基本配置

```bash
# 检查话题配置
cat topics.txt

# 应该看到:
# /tracked_pose
# /map
```

### 2. 运行诊断脚本

```bash
python diagnose_position.py
```

### 3. 查看实时日志

```bash
# 启动应用，观察终端输出
python main.py
```

## 📋 关键日志信息

### 正常情况

```
INFO - 🚗 小车位置标注 (Dialog):
INFO -    物理坐标: (2.50, 1.30)m, 朝向: 0.79rad (45.0°)
INFO -    地图范围: X[-8.10, 10.10]m, Y[-4.80, 1.10]m
INFO -    像素坐标: (106.0, -2.0)px
INFO -    地图尺寸: 182x59px
WARNING -    ⚠️ 小车位置超出地图范围但仍然标注（部分可见）
```

### 异常情况

```
WARNING -    ⚠️ 小车位置严重超出显示范围，跳过标注
WARNING -    允许范围: X[-100, 282]px, Y[-100, 159]px
```

## 🔧 常用命令

### 测试修复效果

```bash
# 运行自动化测试
python test_position_fix.py
```

### 调整日志级别

在 `main.py` 中修改：

```python
# 只看警告和错误
logging.basicConfig(level=logging.WARNING)

# 看所有信息（推荐）
logging.basicConfig(level=logging.INFO)

# 看所有调试信息
logging.basicConfig(level=logging.DEBUG)
```

## 📊 地图坐标范围

### 示例地图（默认配置）

```
分辨率: 0.1 m/px
尺寸: 182 x 59 px
原点: (-8.1, -4.8) m

实际覆盖范围:
  X: -8.10 到 10.10 m  (18.2米宽)
  Y: -4.80 到  1.10 m  (5.9米高)
```

### 坐标转换

```python
# 全局坐标 -> 像素坐标
pixel_x = (pos_x - origin_x) / resolution
pixel_y_from_bottom = (pos_y - origin_y) / resolution
pixel_y = size[1] - pixel_y_from_bottom
```

## ✅ 检查清单

- [ ] `topics.txt` 包含 `/tracked_pose` 和 `/map`
- [ ] WebSocket 连接正常（状态栏显示）
- [ ] 地图数据已接收（状态栏显示地图更新）
- [ ] 小车位置数据已接收（状态栏显示位置更新）
- [ ] 日志级别设置为 `INFO` 或 `DEBUG`
- [ ] 终端可见（用于查看日志）

## 🎯 位置标注规则

### 边界检查

| 位置状态 | 像素范围 | 是否显示 | 日志提示 |
|---------|---------|---------|---------|
| 完全在地图内 | [0, size] | ✅ 显示 | ✅ 在地图范围内 |
| 稍微超出 | [-100, size+100] | ✅ 显示 | ⚠️ 超出范围但仍标注 |
| 严重超出 | 超过±100px | ❌ 不显示 | ⚠️ 严重超出，跳过标注 |

### 标注颜色

- 🟢 **绿色**: 坐标原点 [0, 0]
- 🔵 **蓝色**: 小车位置和朝向（箭头）
- 🔴 **红色**: Beacon位置（圆点）

## 🐛 故障排除

### 问题：看不到小车标注

**检查步骤：**
1. 查看终端日志，确认是否收到 `/tracked_pose` 数据
2. 检查日志中的坐标是否严重超出范围
3. 确认地图数据已加载

**解决方法：**
```bash
# 查看详细信息
# 打开地图查看器 -> 详细信息面板
# 确认小车位置和状态
```

### 问题：小车标记为"超出范围"

**说明：** 这是正常的！只要在±100像素扩展范围内，仍然会显示。

**查看地图范围：**
- 详细信息面板会显示地图的X/Y范围
- 对比小车的实际坐标
- 如果经常超出，可能需要更新地图数据

### 问题：日志信息太多

**解决方法：**
```python
# 在 main.py 中修改
logging.basicConfig(level=logging.WARNING)
```

## 📖 相关文档

- [小车位置显示修复说明.md](小车位置显示修复说明.md) - 详细的修复说明
- [diagnose_position.py](diagnose_position.py) - 诊断脚本
- [test_position_fix.py](test_position_fix.py) - 测试脚本

## 🆘 获取帮助

如果问题仍未解决：

1. 运行诊断脚本并保存输出
2. 记录应用启动时的日志
3. 截图地图查看器的详细信息面板
4. 检查 WebSocket 连接状态

---

**最后更新**: 2026-01-08
