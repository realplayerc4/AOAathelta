# å¡å°”æ›¼æ»¤æ³¢å¿«é€Ÿå¼€å§‹

## å®‰è£…

å¡å°”æ›¼æ»¤æ³¢å™¨å·²é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚ä¾èµ–é¡¹ï¼š
- numpy (å·²åœ¨ requirements.txt ä¸­æˆ–å¯è‡ªåŠ¨å®‰è£…)

```bash
pip install numpy
```

## å¿«é€Ÿæµ‹è¯•

### 1. å¯åŠ¨åº”ç”¨

```bash
cd /home/han14/gitw/AUTOXINGAOA
python main.py
```

### 2. åœ¨ UI ä¸­ä½¿ç”¨

åº”ç”¨å¯åŠ¨åï¼Œæ§åˆ¶æ ä¸­ä¼šæ˜¾ç¤º **"ğŸ”¬ ç¦ç”¨å¡å°”æ›¼æ»¤æ³¢"** æŒ‰é’®

- **ç´«è‰²æŒ‰é’®**: è¡¨ç¤ºå¡å°”æ›¼æ»¤æ³¢å·²å¯ç”¨
- **ç°è‰²æŒ‰é’®**: è¡¨ç¤ºå¡å°”æ›¼æ»¤æ³¢å·²ç¦ç”¨

ç‚¹å‡»æŒ‰é’®åˆ‡æ¢æ»¤æ³¢çŠ¶æ€ã€‚çŠ¶æ€æ ä¼šæ˜¾ç¤ºï¼š
- âœ… å¡å°”æ›¼æ»¤æ³¢å·²å¯ç”¨
- âœ… å¡å°”æ›¼æ»¤æ³¢å·²ç¦ç”¨

### 3. è§‚å¯Ÿæ•ˆæœ

åœ¨ **AOA æ•°æ®** æ ‡ç­¾é¡µä¸­å¯ä»¥çœ‹åˆ°ï¼š
- åŸå§‹æµ‹é‡å€¼ (distance, angle)
- æ»¤æ³¢åçš„åæ ‡ (filtered_x, filtered_y)
- æ»¤æ³¢ç½®ä¿¡åº¦ (filter_confidence)
- é€Ÿåº¦ä¿¡æ¯ (velocity_x, velocity_y)

## ä»£ç ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

```python
from utils.kalman_filter import KalmanFilter
import math

# åˆ›å»ºå•ä¸ªæ»¤æ³¢å™¨
kf = KalmanFilter(
    process_noise=0.1,
    measurement_noise=0.5
)

# å¤„ç†æåæ ‡æµ‹é‡å€¼
distance = 5.0  # ç±³
angle = 45.0    # åº¦

# ç¬¬ä¸€æ¬¡æµ‹é‡ (åˆå§‹åŒ–)
x, y, info = kf.filter_measurement(distance, angle)
print(f"åˆå§‹ä½ç½®: ({x:.3f}, {y:.3f})")

# åç»­æµ‹é‡ (æ›´æ–°æ»¤æ³¢å™¨)
x, y, info = kf.filter_measurement(5.1, 45.5)
print(f"æ»¤æ³¢ä½ç½®: ({x:.3f}, {y:.3f})")
print(f"ç½®ä¿¡åº¦: {info['confidence']:.2f}")
print(f"é€Ÿåº¦: ({info['velocity_x']:.3f}, {info['velocity_y']:.3f})")

# é¢„æµ‹æœªæ¥ä½ç½®
future_x, future_y, future_dist, future_angle = kf.predict_future_position(horizon=1.0)
print(f"1ç§’åé¢„æµ‹ä½ç½®: ({future_x:.3f}, {future_y:.3f})")
```

### å¤šç›®æ ‡è¿½è¸ª

```python
from utils.kalman_filter import MultiTargetKalmanFilter

# åˆ›å»ºå¤šç›®æ ‡æ»¤æ³¢å™¨
mtkf = MultiTargetKalmanFilter(
    process_noise=0.1,
    measurement_noise=0.5,
    target_lost_timeout=2.0
)

# æ ‡ç­¾ 1 çš„æµ‹é‡å€¼
x1, y1, info1 = mtkf.filter_measurement(
    tag_id=1,
    distance=5.0,
    angle_deg=45.0,
    timestamp=None
)

# æ ‡ç­¾ 2 çš„æµ‹é‡å€¼
x2, y2, info2 = mtkf.filter_measurement(
    tag_id=2,
    distance=3.0,
    angle_deg=-30.0
)

# è·å–æ‰€æœ‰ç›®æ ‡çŠ¶æ€
all_targets = mtkf.get_all_targets()
for tag_id, state in all_targets.items():
    if state['initialized']:
        print(f"æ ‡ç­¾ {tag_id}: ä½ç½® ({state['x']:.2f}, {state['y']:.2f}), "
              f"é€Ÿåº¦ {state['speed']:.2f} m/s")

# ç§»é™¤ä¸¢å¤±çš„ç›®æ ‡ (è¶…è¿‡ 2 ç§’æœªæ›´æ–°)
import time
mtkf.remove_lost_targets(current_time=time.time())
```

### ä¸ AOA å·¥ä½œçº¿ç¨‹é›†æˆ

```python
from workers.aoa_worker import AOAWorker

# åˆ›å»º AOA å·¥ä½œçº¿ç¨‹
aoa_worker = AOAWorker(
    port="/dev/ttyCH343USB0",
    baudrate=921600
)

# å¯ç”¨å¡å°”æ›¼æ»¤æ³¢ (é»˜è®¤å¯ç”¨)
aoa_worker.enable_filter(True)

# å¯åŠ¨å·¥ä½œçº¿ç¨‹
aoa_worker.start()

# è¿æ¥ä¿¡å·
aoa_worker.frame_received.connect(on_frame_received)
aoa_worker.position_updated.connect(on_position_updated)

def on_frame_received(frame_info):
    # frame_info åŒ…å«æ»¤æ³¢åçš„åæ ‡
    print(f"æ»¤æ³¢ååæ ‡: ({frame_info['filtered_x']:.3f}, {frame_info['filtered_y']:.3f})")
    print(f"ç½®ä¿¡åº¦: {frame_info['filter_confidence']:.2f}")

def on_position_updated(position):
    print(f"ä½ç½®æ›´æ–°: ({position['x']:.2f}, {position['y']:.2f})")

# ç¦ç”¨æ»¤æ³¢è¿›è¡Œå¯¹æ¯”æµ‹è¯•
aoa_worker.enable_filter(False)

# é‡ç½®æ»¤æ³¢å™¨çŠ¶æ€
aoa_worker.reset_filter()
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. è°ƒæ•´å™ªå£°å‚æ•°

æ ¹æ®å®é™…å™ªå£°æƒ…å†µè°ƒæ•´ï¼š

```python
# é«˜å™ªå£°ç¯å¢ƒ
kf = KalmanFilter(
    process_noise=0.3,      # æ›´ç›¸ä¿¡æµ‹é‡
    measurement_noise=1.0
)

# ä½å™ªå£°ç¯å¢ƒ
kf = KalmanFilter(
    process_noise=0.05,     # æ›´ç›¸ä¿¡æ¨¡å‹
    measurement_noise=0.3
)
```

### 2. è°ƒæ•´é¢„æµ‹æ—¶é—´

```python
# çŸ­æœŸé¢„æµ‹ (200ms)
future_x, future_y, _, _ = kf.predict_future_position(horizon=0.2)

# é•¿æœŸé¢„æµ‹ (1s)
future_x, future_y, _, _ = kf.predict_future_position(horizon=1.0)
```

### 3. ç›‘æ§ç½®ä¿¡åº¦

```python
state = aoa_worker.get_filter_state(tag_id=1)
if state['confidence'] < 0.5:
    print("è­¦å‘Š: ç½®ä¿¡åº¦ä½ï¼Œå¯èƒ½å­˜åœ¨é—®é¢˜")
    aoa_worker.reset_filter()  # é‡ç½®
```

## å¸¸è§é—®é¢˜

### Q: æ»¤æ³¢å’Œä¸æ»¤æ³¢çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

A: 
- **ä¸æ»¤æ³¢**: ç›´æ¥ä½¿ç”¨åŸå§‹æµ‹é‡å€¼ï¼Œå™ªå£°å¤§ä½†å®æ—¶æ€§å¥½
- **æ»¤æ³¢**: å¹³æ»‘å¤„ç†å™ªå£°ï¼Œæ›´ç¨³å®šä½†ç•¥æœ‰å»¶è¿Ÿï¼ˆé€šå¸¸ < 50msï¼‰

### Q: å¯ä»¥åŠ¨æ€æ”¹å˜æ»¤æ³¢å‚æ•°å—ï¼Ÿ

A: å½“å‰ç‰ˆæœ¬ä¸æ”¯æŒåŠ¨æ€æ”¹å˜å‚æ•°ï¼Œéœ€è¦é‡ç½®å¹¶é‡æ–°åˆ›å»ºæ»¤æ³¢å™¨ï¼š

```python
aoa_worker.reset_filter()
# å‚æ•°åœ¨ä¸‹æ¬¡åˆå§‹åŒ–æ—¶ç”Ÿæ•ˆ
```

### Q: å¦‚ä½•åˆ¤æ–­æ»¤æ³¢æ•ˆæœå¥½ä¸å¥½ï¼Ÿ

A: è§‚å¯Ÿä»¥ä¸‹æŒ‡æ ‡ï¼š

```python
state = aoa_worker.get_filter_state(tag_id)
print(f"ç½®ä¿¡åº¦: {state['confidence']:.2f}")        # åº”è¯¥ > 0.7
print(f"é€Ÿåº¦: {state['speed']:.3f} m/s")          # åº”è¯¥åˆç†
print(f"åŠ é€Ÿåº¦: {state['acceleration']:.3f}")     # åº”è¯¥ä¸æ˜¯å¾ˆå¤§
```

### Q: æ»¤æ³¢å™¨éœ€è¦å¤šå°‘æ¬¡æ›´æ–°æ‰èƒ½ç¨³å®šï¼Ÿ

A: é€šå¸¸ 10-20 æ¬¡æ›´æ–°åå³å¯è¾¾åˆ°ç¨³å®šçŠ¶æ€ï¼Œå–å†³äºå™ªå£°å¤§å°ã€‚

## ä¸åŸå§‹ç‰ˆæœ¬å¯¹æ¯”

| åŠŸèƒ½ | ROS ç‰ˆæœ¬ | æœ¬ç‰ˆæœ¬ |
|------|---------|--------|
| åŸºç¡€æ»¤æ³¢ | âœ“ | âœ“ |
| å¤šç›®æ ‡ | âœ“ | âœ“ |
| è¿åŠ¨é¢„æµ‹ | âœ“ | âœ“ |
| UI æ§åˆ¶ | âœ— | âœ“ |
| å‚æ•°åŠ¨æ€è°ƒæ•´ | âœ“ | âœ— (è®¡åˆ’) |
| å¯è§†åŒ– | RViz | PyQt6 |

## è¿›é˜¶è¯é¢˜

### è‡ªå®šä¹‰å™ªå£°åæ–¹å·®çŸ©é˜µ

```python
import numpy as np

kf = KalmanFilter()

# è‡ªå®šä¹‰è¿‡ç¨‹å™ªå£°
kf.Q = np.diag([0.1, 0.1, 0.2, 0.2, 0.3, 0.3])

# è‡ªå®šä¹‰æµ‹é‡å™ªå£°
kf.R = np.diag([0.5, 0.5])
```

### ç›‘æ§å¡å°”æ›¼å¢ç›Š

```python
# é«˜å¡å°”æ›¼å¢ç›Š = æ›´ä¿¡ä»»æµ‹é‡å€¼
# ä½å¡å°”æ›¼å¢ç›Š = æ›´ä¿¡ä»»é¢„æµ‹å€¼

# å¯é€šè¿‡è°ƒæ•´å™ªå£°å‚æ•°é—´æ¥æ§åˆ¶
# Q å¢å¤§ â†’ å¢ç›Šå¢å¤§ (æ›´ç›¸ä¿¡æµ‹é‡)
# R å¢å¤§ â†’ å¢ç›Šå‡å° (æ›´ç›¸ä¿¡é¢„æµ‹)
```

## å‚è€ƒèµ„æº

- [å¡å°”æ›¼æ»¤æ³¢ç»´åŸºç™¾ç§‘](https://en.wikipedia.org/wiki/Kalman_filter)
- [æ‰©å±•å¡å°”æ›¼æ»¤æ³¢](https://en.wikipedia.org/wiki/Extended_Kalman_filter)
- æœ¬é¡¹ç›®: `/home/han14/gitw/AUTOXINGAOA/utils/kalman_filter.py`
- åŸå§‹ ROS ç‰ˆæœ¬: `/home/han14/gitw/AOA/src/kalman_filter_node.py`

---

**æœ€åæ›´æ–°**: 2026-01-08  
**ç»´æŠ¤è€…**: AI Assistant
